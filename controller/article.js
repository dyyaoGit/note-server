const {Router} = require("express");const router = Router();const article = require('../database/model/article')router.post('/', (req, res) => {    if(req.session.user) {        let {title, content, tags, contentText} = req.body        let author = req.session.user.username        article.create({            title,            content,            tags,            author,            contentText,            authorMsg: req.session.user._id        }).then(data => {            res.json({                code: 200,                msg: '文章发布成功'            })        })    }    else {        res.json({            code: 403,            msg: '未登录不能发布笔记'        })    }})router.get('/', (req, res) => {    let {pn=1,size=10,title} = req.query;    let reg = new RegExp(title)    article.aggregate([        {            $match: {                $or: [                    {title: reg},                    {content: reg}                ]            }        },        {            $lookup: {                from: "users",                localField: "authorMsg",                foreignField: "_id",                as: "authorMsg"            }        },        {            $project: {                looknums: 1,                commontnums: 1,                tags: 1,                title: 1,                content: 1,                contentText: 1,                author: 1,                authorMsg: {                    avatar: 1,                    username: 1                },                createdAt: 1,                updatedAt: 1            }        },        {            $sort: {                _id: -1            }        },        {            $limit: size        },        {            $skip: (pn-1)*size        }    ]).then(data => {        res.json({            code: 200,            data        })    })})router.get('/:id', (req, res) => {    let {id} = req.params;    article        .findOneAndUpdate({_id: id},            {                $inc: {looknums: 1}            })       .then(data => {        res.json({            code: 200,            data        })    })})router.get('/type/:type', (req, res) => {    let {type} = req.params;    let {pn=1,size=10} = req.query;    article.find({'tags.name': type})        .sort({_id:-1})        .limit(size)        .skip((pn-1)*(size))        .limit(10)        .then(data => {        res.json({            code: 200,            data,            msg: 'success'        })    })})module.exports = router;